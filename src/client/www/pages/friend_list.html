<template>
	<div class="page">
	  <div class="page-content">
      <div class="navbar color-theme-deeppurple">
        <div class="navbar-bg"></div>
        <div class="navbar-inner sliding">
          <div class="left">
            <a class="link back">
              <i class="icon icon-back"></i>
              <span class="if-not-md">Back</span>
            </a>
          </div>
          <div class="title" style="font-family: cursive"><p class="text-color-deeppurple">Friend List</p></div>
          <div class="right">
            <a class="link icon-only">
              <i class="icon material-icons md-only">people_alt<span class="badge color-red">{{length}}</span></i>
							<i class="icon f7-icons if-not-md">person_2_fill<span class="badge color-red">{{length}}</span></i>
            </a>
          </div>
        </div>
      </div>

			<div class="toolbar color-theme-black">
		    <div class="toolbar-inner">
					<div class="title margin-left" style = "font-size: 12pt;
	                                              font-family: cursive;
	                                              color: black;">
						<a class="link icon-only" href="/friend_requests" >
							Friend requests
						</a>
					</div>
					<a class="link icon-only" href="/friend_requests">
						<i class="icon material-icons md-only">keyboard_arrow_right<span class="badge color-red">{{requestslength}}</span></i>
						<i class="icon f7-icons if-not-md">arrow_right_circle<span class="badge color-red">{{requestslength}}</span></i>
					</a>
		    </div>
		  </div>

			{{#if length}}
			<div class="list sortable">
	      <ul>
					{{#each friend_list}}
	        <li>
	          <div class="item-content">
	            <div class="item-media">
								<i class="icon f7-icons if-not-md color-deeppurple">person</i>
								<i class="icon material-icons md-only color-deeppurple">person_outline</i>
							</div>
	            <div class="item-inner">
								<a href="#tab" class="link">
	              	<div class="item-title" style = "text-transform:capitalize; font-family: cursive; color: black">{{pseudo}}</div>
								</a>
	            </div>
	          </div>
	          <div class="sortable-handler"></div>
	        </li>
					{{/each}}
	      </ul>
	    </div>
			{{else}}
				<div class="item-title item-label" style = "font-size: 12pt;
																										margin: 0;
																									  position: absolute;
																									  top: 50%;
																									  -ms-transform: translateY(-50%);
																									  transform: translateY(-50%); color: grey">
						<center><p><b>Your friends list is empty. Please, add new friends.<b><p><center>
				</div>
			{{/if}}


    </div>
  </div>
</template>
<script>
    return {
      async data() {
				var token = localStorage.getItem('token');

				const friendlistData = {
						url: "http://localhost:3000/friends",
						method: "GET"
				};
				const friendrequestsData = {
						url: "http://localhost:3000/friendrequests",
						method: "GET"
				};

				headers = {
						"Content-Type": "application/json",
						"Authorization": "Bearer " + token,
				}

        let friend_list;
				let friend_requests;
        var length;
				var requestslength;

				try {
          friend_list = await fetch(friendlistData.url, {
																		method: friendlistData.method,
																		headers: headers,
																	})
            .then(res => res.json());
        } catch(err) {
          this.$app.dialog.alert("Error " + err);
        }

				try {
          friend_requests = await fetch(friendrequestsData.url, {
																		method: friendrequestsData.method,
																		headers: headers,
																	})
            .then(res => res.json());
        } catch(err) {
          this.$app.dialog.alert("Error " + err);
        }
				console.log(friend_requests);
				return { friend_list: friend_list.friendlist,
                 length: friend_list.friendlist.length,
							   requestslength: friend_requests.friendrequests.length };
      },

    }
</script>
